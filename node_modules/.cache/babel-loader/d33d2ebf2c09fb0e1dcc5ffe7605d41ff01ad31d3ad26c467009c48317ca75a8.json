{"ast":null,"code":"var _jsxFileName = \"/Users/admin/Downloads/2023 projects/chat-app/src/components/Chats.jsx\",\n  _s = $RefreshSig$();\nimport { doc, serverTimestamp, setDoc, onSnapshot } from 'firebase/firestore';\nimport React, { useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nimport { ChatContext } from '../context/ChatContext';\nimport { db } from '../firebase';\nimport Saved from '../img/saved.jpeg';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Chats = () => {\n  _s();\n  const [chats, setChats] = useState([]);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const {\n    currentChat,\n    dispatch\n  } = useContext(ChatContext);\n  const [message, setMessage] = useState('');\n  useEffect(() => {\n    const getChats = () => {\n      const unsub = onSnapshot(doc(db, 'userChats', currentUser.uid), doc => {\n        setChats(doc.data());\n      });\n      return () => {\n        unsub();\n      };\n    };\n    currentUser.uid && getChats();\n  }, [currentUser.uid]);\n  const handleSelect = u => {\n    dispatch({\n      type: 'CHANGE_USER',\n      payload: u\n    });\n  };\n  const handleCreateChat = async () => {\n    const chatId = `${currentUser.uid}-${currentUser.uid}`;\n    await setDoc(doc(db, 'chats', chatId), {\n      messages: [],\n      users: [currentUser.uid]\n    });\n    await setDoc(doc(db, 'userChats', currentUser.uid, 'chats', chatId), {\n      userInfo: {\n        displayName: currentUser.displayName,\n        photoURL: currentUser.photoURL,\n        uid: currentUser.uid\n      },\n      lastMessage: null\n    });\n    setChats(prevChats => {\n      const updatedChats = {\n        ...prevChats\n      };\n      updatedChats[chatId] = {\n        userInfo: {\n          displayName: currentUser.displayName,\n          photoURL: currentUser.photoURL,\n          uid: currentUser.uid\n        },\n        lastMessage: null\n      };\n      return updatedChats;\n    });\n  };\n  const handleMessageSend = async e => {\n    e.preventDefault();\n    const {\n      uid,\n      displayName,\n      photoURL\n    } = currentUser;\n    const messageObj = {\n      text: message,\n      senderId: uid,\n      senderName: displayName,\n      senderPhotoURL: photoURL,\n      createdAt: serverTimestamp()\n    };\n    const chatRef = doc(db, 'chats', currentChat.id);\n    await setDoc(chatRef, {\n      messages: [...currentChat.messages, messageObj]\n    }, {\n      merge: true\n    });\n    dispatch({\n      type: 'ADD_MESSAGE',\n      payload: messageObj\n    });\n    setMessage('');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chats\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chats-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Chats\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleCreateChat,\n        children: \"New Chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chats-list\",\n      children: Object.keys(chats).map(chatId => {\n        const chat = chats[chatId];\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `chats-list-item ${chatId === currentUser.uid ? 'active' : ''}`,\n          onClick: () => handleSelect(chatId),\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: Saved,\n            alt: \"saved\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chats-list-item-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: chat.userInfo.displayName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 17\n            }, this), chat.lastMessage ? /*#__PURE__*/_jsxDEV(\"p\", {\n              children: chat.lastMessage.text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 101,\n              columnNumber: 37\n            }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"No messages yet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 101,\n              columnNumber: 70\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 15\n          }, this)]\n        }, chatId, true, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this), currentUser.uid && /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSend,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Type your message\",\n        value: message,\n        onChange: handleInputChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 5\n  }, this);\n};\n_s(Chats, \"CHUoexcfnLxbcHhxWmOWehDELD0=\");\n_c = Chats;\nexport default Chats;\nvar _c;\n$RefreshReg$(_c, \"Chats\");","map":{"version":3,"names":["doc","serverTimestamp","setDoc","onSnapshot","React","useContext","useEffect","useState","AuthContext","ChatContext","db","Saved","jsxDEV","_jsxDEV","Chats","_s","chats","setChats","currentUser","currentChat","dispatch","message","setMessage","getChats","unsub","uid","data","handleSelect","u","type","payload","handleCreateChat","chatId","messages","users","userInfo","displayName","photoURL","lastMessage","prevChats","updatedChats","handleMessageSend","e","preventDefault","messageObj","text","senderId","senderName","senderPhotoURL","createdAt","chatRef","id","merge","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","Object","keys","map","chat","src","alt","onSubmit","handleSend","placeholder","value","onChange","handleInputChange","_c","$RefreshReg$"],"sources":["/Users/admin/Downloads/2023 projects/chat-app/src/components/Chats.jsx"],"sourcesContent":["import { doc, serverTimestamp, setDoc, onSnapshot } from 'firebase/firestore';\nimport React, { useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nimport { ChatContext } from '../context/ChatContext';\nimport { db } from '../firebase';\nimport Saved from '../img/saved.jpeg';\n\nconst Chats = () => {\n  const [chats, setChats] = useState([]);\n\n  const { currentUser } = useContext(AuthContext);\n  const { currentChat, dispatch } = useContext(ChatContext);\n  const [message, setMessage] = useState('');\n\n  useEffect(() => {\n    const getChats = () => {\n      const unsub = onSnapshot(doc(db, 'userChats', currentUser.uid), (doc) => {\n        setChats(doc.data());\n      });\n\n      return () => {\n        unsub();\n      };\n    };\n\n    currentUser.uid && getChats();\n  }, [currentUser.uid]);\n\n  const handleSelect = (u) => {\n    dispatch({ type: 'CHANGE_USER', payload: u });\n  };\n\n  const handleCreateChat = async () => {\n    const chatId = `${currentUser.uid}-${currentUser.uid}`;\n\n    await setDoc(doc(db, 'chats', chatId), {\n      messages: [],\n      users: [currentUser.uid],\n    });\n\n    await setDoc(doc(db, 'userChats', currentUser.uid, 'chats', chatId), {\n      userInfo: {\n        displayName: currentUser.displayName,\n        photoURL: currentUser.photoURL,\n        uid: currentUser.uid,\n      },\n      lastMessage: null,\n    });\n\n    setChats((prevChats) => {\n      const updatedChats = { ...prevChats };\n      updatedChats[chatId] = {\n        userInfo: {\n          displayName: currentUser.displayName,\n          photoURL: currentUser.photoURL,\n          uid: currentUser.uid,\n        },\n        lastMessage: null,\n      };\n      return updatedChats;\n    });\n  };\n\n  const handleMessageSend = async (e) => {\n    e.preventDefault();\n\n    const { uid, displayName, photoURL } = currentUser;\n    const messageObj = {\n      text: message,\n      senderId: uid,\n      senderName: displayName,\n      senderPhotoURL: photoURL,\n      createdAt: serverTimestamp(),\n    };\n\n    const chatRef = doc(db, 'chats', currentChat.id);\n    await setDoc(chatRef, { messages: [...currentChat.messages, messageObj] }, { merge: true });\n\n    dispatch({ type: 'ADD_MESSAGE', payload: messageObj });\n\n    setMessage('');\n  };\n\n  return (\n    <div className=\"chats\">\n      <div className=\"chats-header\">\n        <h2>Chats</h2>\n        <button onClick={handleCreateChat}>New Chat</button>\n      </div>\n      <div className=\"chats-list\">\n        {Object.keys(chats).map((chatId) => {\n          const chat = chats[chatId];\n          return (\n            <div\n              className={`chats-list-item ${chatId === currentUser.uid ? 'active' : ''}`}\n              key={chatId}\n              onClick={() => handleSelect(chatId)}>\n              <img src={Saved} alt=\"saved\" />\n              <div className=\"chats-list-item-info\">\n                <h4>{chat.userInfo.displayName}</h4>\n                {chat.lastMessage ? <p>{chat.lastMessage.text}</p> : <p>No messages yet</p>}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n      {currentUser.uid && (\n        <form onSubmit={handleSend}>\n          <input\n            type=\"text\"\n            placeholder=\"Type your message\"\n            value={message}\n            onChange={handleInputChange}\n          />\n          <button type=\"submit\">Send</button>\n        </form>\n      )}\n    </div>\n  );\n};\n\nexport default Chats;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}